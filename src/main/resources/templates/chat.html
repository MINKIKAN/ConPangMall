<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Room</title>
</head>
<body>
<h1>Chat Room</h1>
<form id="loginForm">
    <label for="usernameInput">Username:</label>
    <input type="text" id="usernameInput" required>
    <button type="submit">Connect</button>
</form>
<div id="chatRoom" style="display: none;">
    <ul id="messageList"></ul>
    <input type="text" id="messageInput">
    <button type="button" id="sendBtn">Send</button>
</div>
<script src="/static/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        // WebSocket 연결
        var socket;

        $("#loginForm").submit(function(event) {
            event.preventDefault();

            var username = $("#usernameInput").val();
            socket = new WebSocket("ws://" + location.host + "/chat?username=" + encodeURIComponent(username));

            // 연결되었을 때 실행되는 콜백 함수
            socket.onopen = function() {
                console.log("Connected to WebSocket server");
                $("#loginForm").hide();
                $("#chatRoom").show();
                $("#messageInput").focus();
            };

            // 메시지 수신할 때 실행되는 콜백 함수
            socket.onmessage = function(event) {
                var message = event.data;
                $("#messageList").append("<li>" + message + "</li>");
            };

            // WebSocket 연결이 끊겼을 때 실행되는 콜백 함수
            socket.onclose = function(event) {
                console.log("Disconnected from WebSocket server");
            };

            // 메시지 전송 버튼 클릭 이벤트 핸들러
            $("#sendBtn").click(function() {
                var message = $("#messageInput").val();
                socket.send(message);
                $("#messageInput").val("");
            });
        });
    });
</script>
</body>
</html>